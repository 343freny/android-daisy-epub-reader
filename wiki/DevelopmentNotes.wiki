#summary Some tips and notes for developers and maintainers of this project.
#labels Phase-Implementation

= Introduction =

Here are some tips that may help us to maintain the project effectively and efficiently.
= Building the project in Eclipse =
We use an ant script to extract the svn revision number and insert it as part of the version number in `AndroidManifest.xml`. This script should be run automatically by Eclipse when building the project. Sometimes Eclipse will complain about an empty `{project_loc}`. Re-running the build sometimes clears this error message. However another tip is to make sure the project is selected in the project explorer before running the build. See http://blog.samratdhillon.com/archives/473 for an explanation of this solution.

= Running the tests =
We added JUnit tests in r50, and have been slowly refactoring the code and adding tests to support the refactoring. In the process we're removing unnecessary dependencies on Android libraries, etc. By removing these dependencies the tests can currently (r67) be run using the standard JUnit 3 test runner. 

== Running tests that rely on external files ==
Some of the tests use additional files, rather than having all the contents e.g. of a book stored in the JUnit code. Getting these tests to run in both Eclipse and on an Android Device such as a phone can be challenging and has been something I've been experimenting with from time to time over the life of this project.

On an Android device, the simplest place for these test files to go is on the memory card, which is mapped as {{{/sdcard}}}. See http://code.google.com/p/android-daisy-epub-reader/source/detail?r=320 for an initial set of files. On your computer a similar folder would need to be created, which Eclipse (etc) then uses. 
   * For linux and on a mac simply create /sdcard using a command such as mkdir from a terminal window e.g. {{{mkdir /sdcard}}} You may need Administrative privileges to run this command successfully. The test files will need to be copied onto the sdcard somehow. Here are various ways that might be suitable for you:
      * Using {{{adb push}}} from the command line when the Android device is connected and visible (Use {{{adb devices}}} to check the device has been detected.
      * By 'mounting' the memory card on the phone when the USB connection to the computer has been established. The mounted memory card should then appear as a logical drive in Windows e.g. {{{D:\}}}
      * By physically removing the memory card from the Android device, inserting it into a suitable card reader on the computer, then copy the files from one location (this project) to another. 
   * For Windows, create a directory in the root of the logical drive. Typically this is {{{C:\}}} so from a command {{{cmd}}} window a command such as {{{md c:\sdcard}}} should work. Again you many need administrative permissions to run the command successfully. You can also use Windows Explorer to create the directory. I don't know the details of where to create the folder on a Windows machine with more than one logical drive, I'd suggest starting with creating the directory on the same logical drive as Eclipse uses.
 
Some of the tests currently rely on content in the /Resources project folder currently fail when run using the Android JUnit test runner as the contents of this folder is not pushed to the emulator or devices. We're aware of this limitation, see http://code.google.com/p/android-daisy-epub-reader/issues/detail?id=10 For now please use the standard JUnit test runner from eclipse; and see http://dtmilano.blogspot.com/2009/12/android-testing-external-libraries.html for some tips on configuring the test runner in Eclipse correctly.

== Getting the JUnit tests to run in Eclipse ==
When Eclipse has both the Android SDK and the standard Java tools installed there are 2 possible test runners for JUnit tests. For some reason, the classpath for the Eclipse JUnit Test Runner has the Android library on the classpath, instead of the standard JUnit 3 library. We can fix this by editing the Bootstrap Entries on the Classpath tab for the relevant "run configuration". 

I assume there are more elegant and reliable ways than using Eclipse's GUI, however that's the way I know, so here are the hacky instructions :)
   1. Select the Android entry e.g. Android 1.6 on my machine in the Classpath tab. This will cause the various buttons on the right of the dialog to be enabled. We want the 'Advanced...' button.
   1. Select the Advanced... button, and in the small popup dialog select 'Add Library' in the radio buttons before selecting the OK button. We'll follow this process twice, once for the JRE System Library, and again for the JUnit library.
   1. Select the JRE System Library and the Next button. Accept the "Workspace default JRE". This should work fine, mine's set to jre6.
   1. Click the Finish button.
   1. As mentioned earlier, repeat the steps to add JUnit 3.
   1. You should now have 3 items under Bootstrap Entries. Now Remove the Android library e.g. Android 1.6 for me.
   1. Select the Apply button. Now you should be able to use the Run button to run the JUnit tests with the standard JUnit test runner.

== Running all the tests together in Eclipse ==
In Eclipse, we can create a 'Run Configuration' to run all the tests for a project.

One way to do so, is to create a new Run Configuration e.g. from the Run menu. Select JUnit, then the 'new' icon. 
   * In the Test tab: Pick the radio button next to the text 'Run all the tests in the selected project, package or source folder. Make sure the Test runner: is JUnit 3.
   * In the Arguments tab: nothing needs to be set
   * In the Classpath tab: The bootstrap entries should be set to JRE System Library [J2SE-1.5] and JUnit 3, remove any other entries e.g. remove Android if it's listed. (see the top elsewhere in this wiki page for details of how to configure the classpath).

I've not needed to change any of the other options or settings. So try to Run the tests once you've got this far :)

= Importing the project into Eclipse =
Here are a couple of gotchas that have tripped us up in the past which may be worth documenting to help you fix them if they happen to you too.

== Setting Java Compilation to 5.0 ==
If you decide to import this project into Eclipse, which has the Android Development Tool plugin installed and configured, then you might get the following error message: {{{[2010-06-20 12:57:58 - DaisyReader] Android requires .class compatibility set to 5.0. Please fix project properties.}}}

To fix this problem, select the Project Properties, expand the Java Compiler option, and:
   * Enable Project Specific Settings
   * Set the Compiler Compliance Level to 1.5
   * Select the OK button to save the changes.

Depending on how your Eclipse IDE is configured the project may rebuild automatically. If it doesn't then you can probably force a rebuild by using the Project > Clean... menu.

== Don't share folders ==
Don't use a common folder for your source and your eclipse project as it prevents you from importing the project into your current workspace. I've learnt to create parallel folders or directories e.g. in linux I have:
   * {{{/home/me/workspace/opensourceprojects}}} for my Eclipse workspace
   * {{{/home/me/code/opensourceprojects}}} where I then create a folder called DaisyReader when I use subversion to obtain the source code of this project.

Once I have both the workspace and the code, I use File > Import... > General > Existing Project into Workspace

= Tips =
   * We can generate QR codes for downloads using the zxing online web tool here
http://zxing.appspot.com/generator/
   * Please update the [http://android-daisy-epub-reader.googlecode.com/svn/trunk/releasenotes.txt releasenotes.txt] with siginficant changes. Note some revisions don't need comments, and those made through the web UI will not be recorded in the document anyway.

= Links to information on Android testing =
Here are a collection of links that may be useful as we add more automated tests, and as we re-engineer the application into distinct components.
||URL||Comments||
||http://developer.android.com/guide/samples/ApiDemos/tests/src/com/example/android/apis/app/LocalServiceTest.html||How to create automated tests for an Android Service, useful if and when we make the player a Service.||
||http://dtmilano.blogspot.com/||Lots of useful blog posts, with examples, on automated testing for Android||
||http://www.slideshare.net/marc_chung/testing-android||A short presentation on Automating Android Testing||
||http://code.google.com/p/mwta/downloads/list||My published documents on Android Test Automation.||
   *